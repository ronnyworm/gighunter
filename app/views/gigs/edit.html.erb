<% title "Gig bearbeiten" %>

<h1>Gig anzeigen / bearbeiten</h1>

Gehe direkt zu:
<ul>
	<li><a href="#reminders">Erinnerungen</a></li>
	<li><a href="#mails">Zugehörige E-Mails</a></li>
</ul>

<%= render 'form' %>

<br>
<br>

<div class="div-block">
<h3 id="reminders">Erinnerungen</h3>

<%= link_to "#", "data-toggle" => "modal", "data-target" => "#reminderErstellenPopup", class: "btn btn-default" do %>
  <div style="height:100%;width:100%">
    erstellen <i class="glyphicon glyphicon-phone-alt"></i>
  </div>
<% end %>

<br>
<br>

<% unless @reminders.empty? %>
	<% @reminders.each do |r| %>
		<p><strong>erledigt:</strong> <%= r.done ? "Ja" : "Nein" %></p>
		<p><strong>fällig:</strong> <%= r.due %></p>
		<p><%= raw(nl2br(r.text)) %></p>
		<hr>
	<% end %>
<% else %>
	<em>noch keine ...</em>
<% end %>
</div>

<br>
<br>

<div class="div-block">
<h3 id="mails">Zugehörige E-Mails / Nachrichten</h3>
<% unless @mails.empty? %>
	<% @mails.each do |m| %>
		<div class="div-inner">
		<p><strong>Übertragen:</strong> <%= m.transferred_at.blank? ? raw("<em>noch nicht übertragen</em>") : Rails.date_relative(m.transferred_at.to_date) %></p>
		<span style="display: none" id="transferred_at-<%= m.id %>"><%= readable_datetime(m.transferred_at) %></span>
		<p><strong>Betreff:</strong> <span id="subject-<%= m.id %>"><%= m.subject %></span></p>
		<p><%= raw(nl2br(m.text)) %></p>
		<p style="display:none" id="text-<%= m.id %>"><%= raw(m.text) %></p>
		<%= link_to "löschen", remove_mail_url(m.id), data: { confirm: 'Sicher? Das Löschen kann nicht rückgängig gemacht werden.' }, class: "btn btn-danger btn-xs" %>
		&nbsp;
		<%= link_to "bearbeiten", "#", id: "email-#{m.id}", "data-toggle" => "modal", "data-target" => "#emailBearbeitenPopup", class: "btn btn-default btn-xs" %>
		</div>
	<% end %>
<% else %>
	<em>noch keine ...</em>
<% end %>

<%= link_to "#", "data-toggle" => "modal", "data-target" => "#emailEintragenPopup", class: "btn btn-default" do %>
  <div style="height:100%;width:100%">
    E-Mail / Nachricht eintragen <i class="glyphicon glyphicon-plus"></i>
  </div>
<% end %>
</div>

<br>
<br>
<br>


<%= link_to "Gig löschen", @gig, method: :delete, data: { confirm: I18n.t('models.confirm_to_destroy') }, class: "btn btn-danger" %>

<br>
<br>
<br>

<%= link_to I18n.t("back"), gigs_path, class: "btn btn-default" %>

<%= render "reminder_erstellen_popup" %>
<%= render "email_eintragen_popup" %>
<%= render "email_bearbeiten_popup" %>
<%= render "location_bearbeiten_popup" %>
<%= render "contact_bearbeiten_popup" %>

<script>
$(document).ready(function(){
	<% l = @gig.location %>

	$("#l_currentid").val(<%= l.id %>);
	$("#l_currentname").val("<%= l.name %>");
	$("#l_currentaddress").val("<%= l.address %>");
	$("#l_currentwebsite").val("<%= l.website %>");
	$("#l_currentfestival").prop("checked", <%= l.festival %>);

	$("#l_currentcontact").val("<%= l.contact_summary %>");

    <% c = l.contact %>
    <% if c %>
		$("#c_currentid").val("<%= c.id %>");
		$("#c_currentname").val("<%= c.name %>");
		$("#c_currentemail").val("<%= c.email %>");
		$("#c_currentphone").val("<%= c.telephone %>");
		$("#c_currentinfo").val("<%= c.info %>");
	<% end %>
});
</script>